<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cookie AI — ChatGPT-style (Nemotron Nano)</title>
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<style>
:root{
  --bg:#0b1220; --card:#0f1724; --muted:#94a3b8; --accent:#7c3aed;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;background:linear-gradient(180deg,#030416 0%, #071233 60%);color:#e6eef8}
.app{max-width:980px;margin:18px auto;display:grid;grid-template-columns:320px 1fr;gap:18px;padding:12px}
.panel{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}
.header{display:flex;align-items:center;gap:12px;margin-bottom:8px}
.logo{width:56px;height:56px;flex:0 0 56px}
.brand{font-size:18px;margin:0}
.muted{color:var(--muted);font-size:13px}
.left{display:flex;flex-direction:column;gap:12px;height:78vh}
.kb-list{flex:1;overflow:auto;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02)}
.kb-item{padding:8px;border-radius:8px;margin-bottom:8px;background:rgba(255,255,255,0.015);font-size:13px}
.controls{display:flex;gap:8px;flex-wrap:wrap}
button{background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit;padding:8px 10px;border-radius:10px;cursor:pointer}
button.primary{background:var(--accent);border:none;color:white}
.main{display:flex;flex-direction:column;height:78vh}
.chat{flex:1;overflow:auto;padding:18px;display:flex;flex-direction:column;gap:12px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent)}
.bubble{max-width:78%;padding:12px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6);font-size:14px;line-height:1.35;white-space:pre-wrap}
.user{align-self:flex-end;background:linear-gradient(180deg,#0b3a6b,#06253f);border-top-right-radius:4px;border-bottom-left-radius:12px;}
.ai{align-self:flex-start;background:linear-gradient(180deg,#0f1724,#0b1220);border-top-left-radius:4px;border-bottom-right-radius:12px;border:1px solid rgba(255,255,255,0.02)}
.meta{font-size:11px;color:var(--muted);margin-bottom:6px}
.composer{display:flex;gap:10px;padding:12px;border-top:1px solid rgba(255,255,255,0.03);align-items:center}
textarea{flex:1;min-height:48px;max-height:160px;padding:10px;border-radius:10px;border:none;background:rgba(255,255,255,0.02);color:inherit;resize:none}
.small{font-size:13px;color:var(--muted)}
.footer-small{font-size:12px;color:var(--muted);text-align:center;margin-top:8px}
@media (max-width:900px){.app{grid-template-columns:1fr;height:100%} .left{height:36vh} .main{height:56vh}}
</style>
</head>
<body>
  <div class="app" role="application" aria-label="Cookie AI">
    <div class="panel left">
      <div class="header">
        <div class="logo" aria-hidden="true">
          <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#9f7aea"/><stop offset="1" stop-color="#7c3aed"/></linearGradient></defs>
            <circle cx="50" cy="50" r="44" fill="url(#g)" />
            <circle cx="38" cy="44" r="5" fill="#fff" opacity="0.95"/>
            <circle cx="62" cy="44" r="5" fill="#fff" opacity="0.95"/>
            <rect x="40" y="60" width="20" height="6" rx="3" fill="#fff" opacity="0.95"/>
            <path d="M24 32c4-8 16-14 26-6 10-8 22-2 26 6 0 0-6 4-4 10s-8 8-14 6c-2 4-14 4-18 0-6 2-12-2-12-10s0 0 0 0z" fill="#ffffff20"/>
          </svg>
        </div>
        <div>
          <h1 class="brand">Cookie AI</h1>
          <div class="muted">Your friendly chat companion — Nemotron Nano</div>
        </div>
      </div>

      <div>
        <div class="muted">OpenRouter API Key (paste sk-or-...)</div>
        <input id="apiKey" placeholder="Paste your OpenRouter key here" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit" />
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="saveKey">Save key</button>
          <button id="clearKey">Clear key</button>
          <select id="model" style="padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit">
            <option value="nvidia/nemotron-nano-12b-2-vl:free">Nemotron Nano 12B (free)</option>
          </select>
        </div>
      </div>

      <div style="margin-top:12px" class="muted">Knowledge base</div>
      <div class="kb-list" id="kbList" aria-live="polite"></div>
      <div class="controls">
        <button id="addKB">Add KB</button>
        <button id="exportKB">Export KB</button>
        <button id="importKB">Import KB</button>
      </div>
      <div class="footer-small">Conversations & KB are stored locally in your browser. Export to back up.</div>
    </div>

    <div class="panel main">
      <div class="meta">Chat</div>
      <div class="chat" id="chatWindow" role="log" aria-live="polite"></div>

      <div class="composer">
        <textarea id="input" placeholder="Ask Cookie AI anything..."></textarea>
        <div style="display:flex;flex-direction:column;gap:8px">
          <button id="send" class="primary">Send</button>
          <button id="suggest">Suggest</button>
        </div>
      </div>
    </div>
  </div>

<script>
const OR_URL = 'https://openrouter.ai/api/v1/chat/completions';
const KEY_NAME = 'cookie_ai_or_key';
const KB_NAME = 'cookie_ai_kb';
const CONV_NAME = 'cookie_ai_conv';

const apiKeyInput = document.getElementById('apiKey');
const saveKeyBtn = document.getElementById('saveKey');
const clearKeyBtn = document.getElementById('clearKey');
const modelSelect = document.getElementById('model');

const kbListEl = document.getElementById('kbList');
const addKBBtn = document.getElementById('addKB');
const exportKBBtn = document.getElementById('exportKB');
const importKBBtn = document.getElementById('importKB');

const chatWindow = document.getElementById('chatWindow');
const input = document.getElementById('input');
const sendBtn = document.getElementById('send');
const suggestBtn = document.getElementById('suggest');

function saveKey(){ const v = apiKeyInput.value.trim(); if(!v){ alert('Paste your OpenRouter API key (sk-or-...)'); return; } localStorage.setItem(KEY_NAME, v); alert('Key saved in this browser only.'); }
function loadKey(){ apiKeyInput.value = localStorage.getItem(KEY_NAME) || ''; }
function clearKey(){ localStorage.removeItem(KEY_NAME); apiKeyInput.value=''; alert('Key removed.'); }

saveKeyBtn.onclick = saveKey;
clearKeyBtn.onclick = clearKey;
loadKey();

function loadKB(){ try{ const kb = JSON.parse(localStorage.getItem(KB_NAME) || '[]'); renderKB(kb); }catch(e){ renderKB([]); } }
function saveKB(kb){ localStorage.setItem(KB_NAME, JSON.stringify(kb)); renderKB(kb); }
function renderKB(kb){ kbListEl.innerHTML=''; if(kb.length===0){ kbListEl.innerHTML='<div style="padding:8px;color:var(--muted)">No KB entries yet — add Q/A pairs to help Cookie answer faster.</div>'; return; } kb.forEach((item,i)=>{ const el=document.createElement('div'); el.className='kb-item'; el.innerHTML='<strong>'+escapeHtml(item.q)+'</strong><div style="margin-top:6px"><small>'+escapeHtml(item.a)+'</small></div><div style="margin-top:6px"><button data-i="'+i+'" class="edit">Edit</button> <button data-i="'+i+'" class="del">Delete</button></div>'; kbListEl.appendChild(el); }); kbListEl.querySelectorAll('button.edit').forEach(b=>b.onclick=e=>{ const i=+e.target.dataset.i; const kb=JSON.parse(localStorage.getItem(KB_NAME)||'[]'); const item=kb[i]; const nq=prompt('Edit Q', item.q); if(nq===null) return; const na=prompt('Edit A', item.a); if(na===null) return; kb[i]={q:nq,a:na}; saveKB(kb); }); kbListEl.querySelectorAll('button.del').forEach(b=>b.onclick=e=>{ const i=+e.target.dataset.i; if(!confirm('Delete KB entry?')) return; const kb=JSON.parse(localStorage.getItem(KB_NAME)||'[]'); kb.splice(i,1); saveKB(kb); }); }

addKBBtn.onclick = ()=>{ const q=prompt('Question (short)'); if(!q) return; const a=prompt('Answer'); if(a===null) return; const kb=JSON.parse(localStorage.getItem(KB_NAME)||'[]'); kb.unshift({q:q.trim(),a:a.trim()}); saveKB(kb); };
exportKBBtn.onclick = ()=>{ const kb=localStorage.getItem(KB_NAME)||'[]'; const blob=new Blob([kb],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='cookie_ai_kb.json'; a.click(); URL.revokeObjectURL(url); };
importKBBtn.onclick = ()=>{ const f=document.createElement('input'); f.type='file'; f.accept='.json'; f.onchange=e=>{ const file=e.target.files[0]; if(!file) return; const r=new FileReader(); r.onload=ev=>{ try{ const data=JSON.parse(ev.target.result); if(!Array.isArray(data)) throw new Error('Expected array'); localStorage.setItem(KB_NAME,JSON.stringify(data)); loadKB(); alert('KB imported.'); }catch(err){ alert('Import failed: '+err.message); } }; r.readAsText(file); }; f.click(); };

function appendBubble(role,text){ const el=document.createElement('div'); el.className='bubble '+(role==='user'?'user':'ai'); const when=new Date().toLocaleTimeString(); el.innerHTML='<div style="font-size:12px;color:var(--muted);margin-bottom:6px">'+(role==='user'?'You':'Cookie AI')+' · '+when+'</div><div>'+nl2br(escapeHtml(text))+'</div>'; chatWindow.appendChild(el); chatWindow.scrollTop=chatWindow.scrollHeight; }
function nl2br(s){ return s.replace(/\n/g,'<br/>'); }
function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

function loadConv(){ try{ const conv=JSON.parse(localStorage.getItem(CONV_NAME)||'[]'); conv.forEach(m=>appendBubble(m.role,m.text)); }catch(e){} }
function saveMessage(role,text){ const conv=JSON.parse(localStorage.getItem(CONV_NAME)||'[]'); conv.push({role,text,ts:new Date().toISOString()}); localStorage.setItem(CONV_NAME,JSON.stringify(conv)); }

sendBtn.onclick=async ()=>{ const text=input.value.trim(); if(!text) return; input.value=''; appendBubble('user',text); saveMessage('user',text); const kbReply=kbLookup(text); if(kbReply){ appendBubble('ai',kbReply); saveMessage('assistant',kbReply); return; } appendTyping(); try{ const key=localStorage.getItem(KEY_NAME); if(!key){ removeTyping(); appendBubble('ai','No API key saved — paste your OpenRouter key and Save.'); return; } const model=modelSelect.value||'nvidia/nemotron-nano-12b-2-vl:free'; const messages=buildMessages(text); const resp=await fetch(OR_URL,{ method:'POST', headers:{ 'Content-Type':'application/json','Authorization':'Bearer '+key }, body: JSON.stringify({ model, messages, max_tokens:512, temperature:0.7 }) }); if(!resp.ok){ const txt=await resp.text(); removeTyping(); appendBubble('ai','OpenRouter API error: '+resp.status+' — '+txt+'\\n\\nIf you see CORS errors, you may need a tiny server proxy.'); return; } const data=await resp.json(); const reply=data?.choices?.[0]?.message?.content||JSON.stringify(data); removeTyping(); appendBubble('ai',reply); saveMessage('assistant',reply); }catch(err){ removeTyping(); appendBubble('ai','Request failed: '+err.message); } };

function buildMessages(userText){ const conv=JSON.parse(localStorage.getItem(CONV_NAME)||'[]'); const recent=conv.slice(-10).flatMap(m=>({ role: m.role==='user'?'user':'assistant', content: m.text })); const messages=[{role:'system',content:'You are Cookie AI, a friendly helpful assistant.'}, ...recent, {role:'user',content:userText}]; return messages; }

let typingEl=null;
function appendTyping(){ typingEl=document.createElement('div'); typingEl.className='bubble ai'; typingEl.id='typing'; typingEl.innerHTML='<div style="font-size:12px;color:var(--muted);margin-bottom:6px'>Cookie AI · '+new Date().toLocaleTimeString()+'</div><div>⠂⠂⠂</div>'; chatWindow.appendChild(typingEl); chatWindow.scrollTop=chatWindow.scrollHeight; }
function removeTyping(){ document.getElementById('typing')?.remove(); typingEl=null; }

suggestBtn.onclick=()=>{ input.value='How do I reset my password?'; input.focus(); };
function tokenize(s){ return (s||'').toLowerCase().replace(/[^\w\s]/g,'').split(/\s+/).filter(Boolean); }
function kbLookup(q){ const kb=JSON.parse(localStorage.getItem(KB_NAME)||'[]'); if(kb.length===0) return null; const qt=tokenize(q); let best={score:0,idx:-1}; kb.forEach((item,i)=>{ const tokens=tokenize(item.q+' '+item.a); let s=0; qt.forEach(t=>{ if(tokens.includes(t)) s++; }); if(s>best.score){ best={score:s,idx:i}; } }); if(best.idx!==-1 && best.score>=Math.max(1,qt.length*0.25)) return kb[best.idx].a; return null; }

loadKB();
loadConv();
if(!localStorage.getItem(KB_NAME)){ const seed=[{q:'How to reset password',a:'Go to Settings → Account → Reset password. If you cannot access your email contact support.'},{q:'Contact support',a:'Email support@example.com with your order number and a short description.'}]; localStorage.setItem(KB_NAME,JSON.stringify(seed)); loadKB(); }
document.addEventListener('keydown',e=>{ if(e.ctrlKey && e.key==='k'){ e.preventDefault(); alert('Cookie AI — ready!'); } });
</script>
</body>
</html>
